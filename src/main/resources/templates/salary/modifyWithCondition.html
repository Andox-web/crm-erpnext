<!DOCTYPE html>
<html layout:decorate="~{template}" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Définir des critères</title>
    <style>
        
        .form-wrapper {
            background-color: var(--light-color);
            padding: var(--content-padding);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            font-family: var(--font-family);
            margin-top: 2rem;
        }

        h2 {
            color: var(--primary-color);
        }

        label {
            color: var(--dark-color);
            font-weight: bold;
        }

        select, input{
            border-radius: var(--border-radius);
        }

        .btn-submit {
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius);
        }

        .btn-add {
            background-color: var(--success-color);
            color: white;
            border-radius: var(--border-radius);
        }

        .btn-remove {
            background-color: var(--danger-color);
            color: white;
            border-radius: var(--border-radius);
        }
        .percentage-label {
            position: relative;
            border-radius:  0 var(--border-radius) var(--border-radius) 0  !important;
        }

        .percentage-label::after {
            content: "%";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            font-size: 1rem;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container">
        <div class="form-wrapper">
            <h2>Définir les critères</h2>
            <div th:if="${error}" class="alert-message"
                 style="background-color: var(--danger-color); color: var(--light-color)">
                [[${error}]]
            </div>
            <div th:if="${success}" class="alert-message"
                 style="background-color: var(--success-color); color: var(--light-color)">
                [[${success}]]
            </div>
            <form method="post">
                <!-- Select multiple employés
                <div class="mb-3">
                    <label for="employes" class="form-label">Employés</label>
                    <select id="employes" name="employes" class="form-select" multiple>
                        <option th:each="emp : ${employes}" th:value="${emp.name}" th:text="${emp.employeeName}">Nom Employé</option>
                    </select>
                </div> -->

                <!-- Input base -->
                <div class="form-group">
                    <label for="base">Base (en %)</label>
                    <div class="input-group">
                        <select id="sign" class="form-select" name="sign">
                            <option value="1">+</option>
                            <option value="-1">-</option>
                        </select>
                        <div class="percentage-label" style="flex: 1; position: relative;">
                            <input type="number" id="base" name="base" class="form-control" step="0.1" value="1" />
                        </div>
                    </div>
                </div>
                
                <!-- Groupe dynamique -->
                <div id="groupe-conditions">
                    <div class="row g-2 mb-2 condition-group">
                        <div class="col-md-4">
                            <select name="composant[]" class="form-select">
                                <option value="">-- Composant --</option>
                                <option th:each="comp : ${components}" th:value="${comp.salaryComponent}" th:text="${comp.salaryComponent}">Composant</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select name="operateur[]" class="form-select">
                                <option value=">">&gt;</option>
                                <option value="<">&lt;</option>
                                <option value="=">=</option>
                                <option value=">=">&ge;</option>
                                <option value="<=">&le;</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="number" name="valeur[]" class="form-control" placeholder="Valeur" />
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-add" onclick="ajouterCondition(this)">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-submit mt-3">Soumettre</button>
            </form>
        </div>
    </div>
    <script>
        function ajouterCondition(button) {
            const container = document.getElementById("groupe-conditions");
            const group = button.closest('.condition-group');
            const clone = group.cloneNode(true);

            // Réinitialiser les valeurs
            clone.querySelectorAll('input, select').forEach(el => {
                if (el.tagName === 'SELECT') el.selectedIndex = 0;
                if (el.tagName === 'INPUT') el.value = '';
            });

            // Changer bouton "+" en bouton "-"
            const newButton = clone.querySelector('button');
            newButton.classList.remove('btn-add');
            newButton.classList.add('btn-remove');
            newButton.innerHTML = '<i class="fa fa-minus"></i>';
            newButton.setAttribute('onclick', 'supprimerCondition(this)');

            container.appendChild(clone);
        }

        function supprimerCondition(button) {
            const group = button.closest('.condition-group');
            group.remove();
        }
    </script>
</div>


</body>
</html>
